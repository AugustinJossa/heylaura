<h1 class="title-index"><%= @matched_jobs.count %> postes pourraient t'intérresser</h1>

<div class='white-wraper'>

<div class='flexbox'>
  <div class='flex-item-1'>
    <div class='trait-inf'>Critères de matching</div>

  <div class='filter-box'>
  <%= simple_form_for @profile do |f| %>

    <%= f.input :company_type, label: "Type d'entreprise", required: false, collection: Company::COMPANY_TYPE_ARRAY, input_html: { class: 'simple-form-field' } %>
    <%= f.input :company_industry, label: "Secteur", required: false, collection: Company::COMPANY_INDUSTRY_ARRAY, input_html: { class: 'simple-form-field' } %>
    <%= f.input :company_size, label: "Taille d'entreprise", required: false, collection: Company::COMPANY_SIZE_ARRAY, input_html: { class: 'simple-form-field' }%>
    <%= f.input :job_type, label: "Métier", required: false, collection: Job::JOB_TYPE_ARRAY, input_html: { class: 'simple-form-field' } %>
    <%= f.input :job_location, label: "Ville", required: false, input_html: { class: 'simple-form-field' } %>
    <%= f.input :job_remote, label: "Home office", required: false, collection: Job::JOB_REMOTE_ARRAY, input_html: { class: 'simple-form-field' } %>
    <%= f.input :job_contract, label: "Type de contrat", required: false, collection: Job::JOB_CONTRACT_ARRAY, input_html: { class: 'simple-form-field' } %>
    <%= f.input :job_min_salary, label: "Salaire min", required: false, input_html: { class: 'simple-form-field' }  %>
    <%= f.submit "Go Laura!", class: "update-btn" %>

  <% end %>
  </div>

  </div>

  <div class='flex-item-2'>
    <% @matched_jobs.each do |matched_job| %>

<%= link_to profile_matched_job_path(@profile, matched_job) do %>

      <div class="mycard">
        <div class="line-1">
          <div class="title"><%= matched_job.job.company.name.upcase %></div>
          <%= image_tag matched_job.job.company.logo.url(:logo), :class => "card-user"%>
        </div>
        <div class="line-2">
          <h2><%= matched_job.job.title %></h2>
          <p><% if matched_job.job.description.split(" ").length > 60 %>
            <%= "#{matched_job.job.description.split(" ")[0..60].join(" ")} ..." %>
            <% else %>
            <%= matched_job.job.description %>
            <% end %>
          </p>
        </div>
        <div class="line-3">
          <div class="tags-1">
            <!-- gestion du bookmarked -->
            <div>
              <% if matched_job.status == 'Bookmarked' %>
                <%= simple_form_for [@profile, matched_job], remote: true do |f| %>
                <%= f.input :status, as: :hidden, input_html: { value: nil } %>
                <%= f.button :submit, "coeur", class: "btn btn-success delete-btn" %>
                <%= link_to profile_matched_jobs_path do %>
                  <span><i class="fa fa-heart unbookmark-btn" aria-hidden="true" method:bookmark></i> </span>
                <% end %>
                <% end %>
              <% else %>
                <%= simple_form_for [@profile, matched_job], remote: true do |f| %>
                <%= f.input :status, as: :hidden, input_html: { value: 'Bookmarked' } %>
                <%= f.button :submit, 'btn', class: "delete-btn", data: {target: "#modal-bookmarked", toggle: "modal"} %>

                <%= link_to profile_matched_jobs_path do %>
                  <span><i class="fa fa-heart-o coeur bookmark-btn" aria-hidden="true" method:bookmark></i> </span>
                  <% end %>
                <% end %>

              <% end %>


            </div>


            <!-- ... -->

            <div class="meter">
              <span style="width:<%= matched_job.matching*100 %>%"></span>
            </div>
            <div class="pourcentage"> <%= (matched_job.matching*100).to_i.round %>% de matching</div>
          </div>

          <div class="tags-2">
            <div class="tags-elements-adapt"></div>
            <div class="tags-elements"><%= matched_job.job.contract %></div>
            <div class="tags-elements"><%= "#{matched_job.job.salary.round(0)} €" %></div>
            <div class="tags-elements"><%= matched_job.job.remote %></div>
          </div>

        </div>
    <!--     <a class="card-link" href="#" ></a> -->
      </div>

    <% end %>


        <% end %>



  </div>






  </div>

</div>

<!-- Modal -->
          <div class="modal fade" id="modal-bookmarked" role="dialog">
            <div class="modal-dialog">

              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  <div class="modal-title">
                    L'offre a bien été ajoutée à tes favoris
                  </div>
                </div>
              </div>

            </div>
          </div>




<% content_for(:js) do %>
  <%= javascript_tag do  %>

    var btnsSupr = document.querySelectorAll('.delete-btn');

    btnsSupr.forEach((element) => {
      element.style.display = 'none';
    });


    var unbookmark = document.querySelectorAll('.unbookmark-btn');
    console.log(unbookmark);

    unbookmark.forEach((element) => {
        element.addEventListener("click", (event) => {

          event.target.parentElement.parentElement.parentElement.querySelector('.delete-btn').click();
      });
    });


    var bookmark = document.querySelectorAll('.bookmark-btn');
    console.log(bookmark);

    bookmark.forEach((element) => {
        element.addEventListener("click", (event) => {

          event.target.parentElement.parentElement.parentElement.querySelector('.delete-btn').click();
      });
    });

  <% end %>
<% end %>

